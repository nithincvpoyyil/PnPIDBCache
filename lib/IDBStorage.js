"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,u)}s((n=n.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.IDBStorageWrapper=exports.IDBStorage=exports.DEFAULT_STORE_NAME=exports.DEFAULT_DB_NAME=void 0;var idb_keyval_1=require("idb-keyval");exports.DEFAULT_DB_NAME="IDBStorgeDBForPnP",exports.DEFAULT_STORE_NAME="IDBStorgeDBStoreNameForPnP";var IDBStorage=function(){function e(e){this.isIndexedDBError=!1,window.indexedDB||(this.isIndexedDBError=!0),e&&e.dbName&&e.storeName?this._idbStore=(0,idb_keyval_1.createStore)(e.dbName,e.storeName):this._idbStore=(0,idb_keyval_1.createStore)(exports.DEFAULT_DB_NAME,exports.DEFAULT_STORE_NAME)}return Object.defineProperty(e.prototype,"indexedDBError",{get:function(){return this.isIndexedDBError},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,(0,idb_keyval_1.keys)(this._idbStore)];case 1:return[2,e.sent().length]}}))}))},enumerable:!1,configurable:!0}),e.prototype.clear=function(){return(0,idb_keyval_1.clear)(this._idbStore)},e.prototype.getItem=function(e){return(0,idb_keyval_1.get)(e,this._idbStore)},e.prototype.removeItem=function(e){return(0,idb_keyval_1.del)(e,this._idbStore)},e.prototype.setItem=function(e,t){return(0,idb_keyval_1.set)(e,t,this._idbStore)},e.prototype.getEntries=function(){return(0,idb_keyval_1.entries)(this._idbStore)},e.prototype.test=function(){return!!window.indexedDB},e}();exports.IDBStorage=IDBStorage;var IDBStorageWrapper=function(){function e(e){this.customStoreparams=e,e&&e.dbName&&e.storeName||(this.customStoreparams={dbName:exports.DEFAULT_DB_NAME,storeName:exports.DEFAULT_STORE_NAME}),this.idbStorage=new IDBStorage(this.customStoreparams)}return e.prototype.get=function(e){var t=this;return new Promise((function(r,n){t.idbStorage.indexedDBError&&r(null),t.idbStorage.getItem(e).then((function(r){return __awaiter(t,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return r&&r.indexedDBCache?r.expiry<=new Date?[4,this.delete(e)]:[3,2]:[3,3];case 1:return t.sent(),[2,null];case 2:return[2,r.data];case 3:return[2]}}))}))})).then((function(e){r(e)}),(function(){r(null)}))}))},e.prototype.put=function(e,t,r){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(o){if(this.idbStorage.indexedDBError)return[2,Promise.resolve()];try{return n={expiry:r,data:t,indexedDBCache:1},[2,this.idbStorage.setItem(e,n)]}catch(e){return[2,Promise.reject()]}return[2]}))}))},e.prototype.delete=function(e){return this.idbStorage.indexedDBError?Promise.resolve():this.idbStorage.removeItem(e)},e.prototype.deleteExpired=function(){var e=this;return this.idbStorage.indexedDBError?Promise.resolve():new Promise((function(t,r){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){try{this.idbStorage.clear().then((function(){t()}),(function(){r()}))}catch(e){r(e)}return[2]}))}))}))},e}();exports.IDBStorageWrapper=IDBStorageWrapper;